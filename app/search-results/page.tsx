import FlightResultsTable from "@/components/flight-results-table";
import FlightResultsSkeleton from "@/components/flight-results-table-skeleton";
import ProgressIndicator from "@/components/progress-indicator";
import { Button } from "@/components/ui/button";
import getSearchResults from "@/lib/getData";
import { Metadata } from "next";

export const metadata: Metadata = {
  title: "Search Results | FlyEasy",
  description: "Generated by create next app",
};

export default async function SearchResults({
  searchParams,
}: {
  searchParams: {
    outbound_date: string;
    return_date: string;
    departure_id: string;
    arrival_id: string;
    adults: string;
  };
}) {
  const departure_id: string | null = searchParams.departure_id;
  const arrival_id: string | null = searchParams.arrival_id;

  // fetch options
  const options = {
    method: "POST",
    headers: {
      "content-type": "application/json",
      Authorization: `Bearer ${process.env.SERP_API_KEY}`,
    },
    body: JSON.stringify({
      outbound_date: searchParams.outbound_date,
      return_date: searchParams.return_date,
      adults: searchParams.adults,
      departure_id: searchParams.departure_id,
      arrival_id: searchParams.arrival_id,
      currency: "USD",
    }),
  };

  const results = await getSearchResults(options);

  return (
    <div className='min-h-screen bg-gray-100'>
      <header className='bg-white shadow'>
        <div className='container mx-auto px-4 py-4 flex justify-between items-center'>
          <div className='w-40 h-8 bg-gray-300'></div>
          <div className='space-x-4'>
            <Button variant='ghost'>LOG IN</Button>
            <Button>SIGN UP</Button>
          </div>
        </div>
      </header>
      <main className='container mx-auto px-4 py-8'>
        <ProgressIndicator />

        {typeof results != "undefined" && departure_id && arrival_id ? (
          <FlightResultsTable
            departureID={departure_id}
            arrivalID={arrival_id}
            results={results}
          />
        ) : (
          <FlightResultsSkeleton />
        )}
      </main>
    </div>
  );
}
